<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
    
    <script src="../lib/polyfills.js"></script>
    <script src="../lib/pixel.js"></script>
    <script src="../lib/sprite.js"></script>
    <script src="../lib/sprite_sheet.js"></script>
    <script src="../lib/animated_sprite.js"></script>
    <script src="../lib/tile.js"></script>
    <script src="../lib/player.js"></script>
    <script src="../lib/fps_counter.js"></script>
    <script src="../lib/layer.js"></script>
    <script type="text/javascript">
        
        document.onreadystatechange = function () {
            if (document.readyState == "complete") {
                var P = new PixelJS();
                
                P.init({
                    canvas: 'pixeljs'  
                });
                
                var backgroundLayer = P.createLayer("background");
                
                var background = backgroundLayer.createTile();
                background.pos = { x: 0, y: 0 };
                background.size = { width: 800, height: 600 };
                background.load( { name: 'grass_generic.png' }, function () {
                    var playerLayer = P.createLayer("players");
                    var player = playerLayer.createPlayer();
                    player.animationSpeed = 0.125;
                    
                    var fence = backgroundLayer.createTile();
                    
                    fence.pos = { x: 0, y: 408 };
                    fence.size = { width: 200, height: 32 };
                    fence.load( { name: 'grass_fencing.png' }, function () {
                        player.load({ name: 'char112.png', frames: 3, rows: 4 }, function (sender) {     
                            player.defaultFrame = 1;
                            player.movementSpeed = 0.125;
                            player.pos.x = 200;
                            player.pos.y = 300;
                            
                            var backgroundDrawn = false;

                            P.run(function (elapsedTime, dt) {   
                                if (backgroundDrawn) {
                                    backgroundLayer.requiresDraw = false;   
                                }
                                
                                backgroundDrawn = true;
                            }); 
                        });
                    });
                });
            }
        }
        
    </script>
    <style>
        .scene-layer {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <div id="pixel.js" style="border: 1px black dotted; position: absolute; left: 50%; top: 50%; margin: -300px 0 0 -400px;">
        <canvas id="pixeljs" width="800" height="600" class="scene-layer">
        </canvas>
    </div>
</body>
</html>